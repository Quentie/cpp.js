{"name":"Cpp.js","body":"cpp.js\r\n========\r\n\r\n#### C Preprocessor in Javascript ####\r\n\r\ncpp.js is a tiny implementation of the C preprocessor (cpp) in Javascript (js).\r\n\r\nIt supports all features of the original, including `#include`'s and the\r\nstringization (`#`) and token concatenation (`##`) operators. Macro substitution\r\nis performed (almost) in accordance with the C99 specification. See the \r\n*Conformance* section for more information.\r\n\r\nMy pet project medea.js uses this code to preprocess GLSL shaders, other use\r\ncases might even exist. \r\n\r\n### Releases ###\r\n\r\nYou can find both normal and minified release builds in the [download tab](https://github.com/acgessler/cpp.js/downloads).\r\n\r\n - __1.0__ (2011-01-28) Initial release. \r\n\r\n### License ###\r\n\r\nModified BSD license, see the LICENSE file for the full text. Means \r\nbasically you can do everything with it, except claim you wrote it\r\nand a copy of the license should always be distributed (a backlink\r\nto this page is also fine).\r\n\r\n### Usage ###\r\n\r\n(This sample is effectively the entire external documentation, feel free to contribute further contents).\r\n\r\n```javascript\r\n\r\n// Setup basic settings for the preprocessor. The values as shown below\r\n// are the default values and can be omitted.\r\nvar settings = { \r\n\r\n   // signal string that starts a preprocessor command, \r\n   // only honoured at the beginning of a line.\r\n   signal_char : '#',\r\n\r\n   // function used to print warnings, the default \r\n   // implementation logs to the console.\r\n   warn_func : null,\r\n\r\n   // function used to print critical errors, the default \r\n   // implementation logs to the console and throws.\r\n   error_func : null,\r\n   \r\n   // function to be invoked to fetch include files.\r\n   // See the section \"Handling include files\" below.\r\n   include_func : null,\r\n   \r\n   // function used to strip comments from the input file.\r\n   // The default implementation handles C and C++-style\r\n   // comments and also removes line continuations.\r\n   // Since this function is invoked on all files before\r\n   // any preprocessing happens, it can be thought of as a \r\n   // \"preprocessor to the preprocessor\".\r\n   comment_stripper : null\r\n}\r\n\r\n// Create an instance of the library. `settings` is optional.\r\nvar pp = cpp_js( settings );\r\n\r\n// Predefine some symbols, the same effect could be reached\r\n// by prepending the corresponding #define's to the source\r\n// code for preprocessing but this is way nicer.\r\n// cpp.js by itself does not predefine any symbols.\r\nvar predefined = {\r\n   DEBUG : '',               // equivalent to `#define DEBUG`\r\n   ANOTHER_DEFINE : '248935' // equivalent to `#define ANOTHER_DEFINE 248935`\r\n};\r\n\r\npp.define_multiple(predefined);\r\n\r\npp.define(\"macro_with_args(a,b)\",\"a ## b\");\r\n\r\npp.undef('DEBUG');\r\npp.defined('DEBUG'); // => false\r\n\r\n// Now invoke the preprocesser on the given text block.\r\n// The processor keeps the state obtained from executing the text \r\n// block. Therefore, if run() is invoked on multiple text blocks, any\r\n// defines from a block will also apply to its successors.\r\n\r\n// However, a text block is assumed to be syntactically complete \r\n// i.e. all conditional blocks and also all comments must be closed\r\n// and may not leap into the next block.\r\nvar preprocessed_source = pp.run(text);\r\n\r\n// Calling clear() resets all defined values. The effect is the same as if\r\n// a fresh cpp.js instance with same settings was created.\r\npp.clear();\r\n\r\n```\r\n\r\n### node.js ###\r\n\r\ncpp.js also works as a node.js module:\r\n\r\n\r\n```javascript\r\n\r\nvar cpp = require(\"./cpp\");\r\nvar pp = cpp.create( settings );\r\n\r\n// ...\r\n// same as above\r\n\r\n```\r\n\r\n### Handling #include files ###\r\n\r\nBy default, include directives cause errors. To enable `#include`-support, one\r\nmust specify an `include_func` in the initial settings. This function receives\r\nthe name of the include file that is requested and a closure to resume\r\npreprocessing as soon as the file is available (the mechanism is thus \r\ncompatible with asynchronous file reading, i.e. via AJAX or node.js).\r\n\r\n**If include files are enabled, cpp.js becomes strictly asynchronous** and\r\n`run()` always returns null. Therefore it is also necessary to specify an\r\n`completion_func` callback in the settings, which is invoked as soon as \r\npreprocessing is complete, receiving the preprocessed text as parameter.\r\n\r\nSpecifying an `include_func` but no `completion_func` is not allowed.\r\n\r\nThe basic structure for this scenario is like this:\r\n\r\n```javascript\r\n\r\nsettings.include_func = function(file, is_global, resumer, error) {\r\n\r\n\t// `is_global` is `true` if the file name was enclosed\r\n\t// in < .. > rather than \" .. \".\r\n\r\n    do_fancy_magic_to_fetch_this_file(file, function(contents) {\r\n\t\t// call resumer(null) if the file is not accessible\r\n\t   resumer(contents);\r\n\t});\r\n};\r\n\r\nsettings.completion_func = function(preprocessed_text) {\r\n    // process result\r\n};\r\n```\r\n\r\n### Conformance ###\r\n\r\ncpp.js was written with the C99 language standard in mind and conforms in most\r\naspects. However, its expression evaluation engine is based on `eval`, whose\r\narithmetics are not strictly C-compliant (i.e. underflow/overflow).\r\n\r\n`#` is evaluated regardless whether the next token is a substituted macro\r\nargument or not.\r\n\r\nIt is also important to note that cpp.js does not tokenize the input stream\r\ninto preprocessing tokens (it works on the plain text input instead). The \r\noutput should in almost all cases be correct, though, so this is no matter\r\nfor most use cases. However, this design decision made proper handling of \r\nplaceholder preprocessing tokens tricky and there are surely bugs in this\r\npart.\r\n\r\nError messages are mostly taken directly from `gnu cpp`.\r\n\r\nNot supported are:\r\n  \r\n - variadic argument lists\r\n - character constants in arithmetics\r\n - predefined macro names from C (i.e. `__FILE__`)\r\n - `#line`\r\n\r\n\r\n\r\n\r\n","tagline":"node.js-compatible implementation of the C Preprocessor (cpp) in Javascript","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}